# systemdが動作するAlmaLinux 8ベースイメージ
FROM almalinux:8

# systemdの動作に必要なパッケージとSSHサーバーをインストール
RUN dnf update -y && \
    dnf install -y systemd openssh-server openssh-clients sudo && \
    dnf clean all

# systemdの設定
RUN systemctl enable sshd && \
    systemctl mask getty@tty1.service && \
    systemctl mask serial-getty@ttyS0.service

# SSH鍵を生成
RUN ssh-keygen -A

# systemdをPID 1として起動
CMD ["/sbin/init"]

# 必要なディレクトリを作成
RUN mkdir -p /var/run/sshd

# systemdが正常に動作するための設定
VOLUME ["/sys/fs/cgroup"]
